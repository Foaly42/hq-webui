$("document").ready(function(){var r="http://172.16.23.3";var a="/config/xmlapi";var aW="_USER1004";var x=1024;var D=490;var V=[20,50,100,500];var d=100;var an="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/themes/";var t="overcast";var aq="/jquery-ui.css";var H="1.3.3";var p,aX,y,f,Y,aa,I,aS,aC,aT,aO,R,j,L,aM,m;var ad=false;var aB=false;var O=false;var G=false;var ar=false;var aN=false;var z=false;var aH=false;var aP=false;var at=false;var A;var aw=$("#gridVariables");var ab=$("#gridPrograms");var e=$("#gridRooms");var P=$("#gridFunctions");var g=$("#gridStates");var ao=$("#gridProtocol");var X=$("#gridRssi");var aQ=$("#gridScriptVariables");var W=$("#gridInfo");var C=$("#variableInput");var S=$("#variableName");var K=$("#variableId");var w=$("#datapointInput");var B=$("#programId");var ag=$("#programName");var aj=$("#dialogRunProgram");var N=$("#dialogClearProtocol");var aG=$("#dialogAjaxError");var b=$("#dialogEditVariable");var U=$("#dialogEditDatapoint");var ax=$("#dialogSelectTheme");al();$("ul.tabsPanel li a img").hide();$("#tabs").tabs();$("button").button();$("ul.tabsPanel").append("<button style='font-size: 0.8em; float:right' id='buttonSelectTheme'>Theme</button> ");$("#buttonSelectTheme").button().click(function(){ax.dialog("open")});am();var aD=["ise_id","Name","Variable","Wert","Einheit","Werteliste","Wert (text)","min","max","type","Typ","Zeitstempel"];var aI=[{name:"ise_id",index:"ise_id",width:60,xmlmap:function(aY){return $(aY).attr("ise_id")}},{name:"name",index:"name",width:150,xmlmap:function(aY){return $(aY).attr("name")}},{name:"variable",index:"variable",width:40,hidden:true,xmlmap:function(aY){return $(aY).attr("variable")}},{name:"value",index:"value",width:150,xmlmap:function(aY){var aZ=$(aY).attr("value");switch($(aY).attr("subtype")){case"0":aZ=parseFloat(aZ);aZ=aZ.toFixed(2);break;case"29":aZ=$(aY).attr("value_text");break}return aZ}},{name:"unit",index:"unit",width:30,xmlmap:function(aY){return $(aY).attr("unit")}},{name:"value_list",index:"value_list",width:120,hidden:true,xmlmap:function(aY){return $(aY).attr("value_list")}},{name:"value_text",index:"value_text",width:50,hidden:true,xmlmap:function(aY){return $(aY).attr("value_text")}},{name:"min",index:"min",width:30,xmlmap:function(aY){return $(aY).attr("min")}},{name:"max",index:"max",width:30,xmlmap:function(aY){return $(aY).attr("max")}},{name:"type",index:"type",width:60,hidden:true,xmlmap:function(aY){return $(aY).attr("type")}},{name:"subtype",index:"subtype",width:40,xmlmap:function(aY){return $(aY).attr("subtype")},formatter:function(aY){return c(aY)}},{name:"timestamp",index:"timestamp",width:75,xmlmap:function(aY){return i($(aY).attr("timestamp"))}}];var T=["id","Name","Beschreibung","Aktiv","Zeitstempel"];var ac=[{name:"id",index:"id",width:60,xmlmap:function(aY){return $(aY).attr("id")}},{name:"name",index:"name",width:200,xmlmap:function(aY){return $(aY).attr("name")}},{name:"description",index:"description",width:200,xmlmap:function(aY){return $(aY).attr("description")}},{name:"active",index:"active",width:40,xmlmap:function(aY){return $(aY).attr("active")}},{name:"timestamp",index:"timestamp",width:75,xmlmap:function(aY){return i($(aY).attr("timestamp"))}}];var h=["ise_id","Name","Adresse","Schnittstelle","Gerätetyp","Räume","Gewerke","unreach","sticky_unreach","config_pending","Servicemeldungen"];var aV=[{name:"ise_id",index:"ise_id",align:"right",width:80,fixed:true,xmlmap:function(aY){return $(aY).attr("ise_id")},classes:"ise_id"},{name:"name",index:"name",width:240,fixed:true,xmlmap:function(aY){return $(aY).attr("name")}},{name:"address",index:"address",width:79,fixed:true,xmlmap:function(a0){var aY=$(a0).attr("ise_id");var aZ=$(a0).attr("name");switch(aZ){case"CCURF":return"BidCos-RF";break;case"CCUWIR":return"BidCos-Wir";break;default:return aM.find("device[ise_id='"+$(a0).attr("ise_id")+"']").attr("address")}}},{name:"iface",index:"iface",width:78,fixed:true,xmlmap:function(aZ){var aY=$(aZ).attr("ise_id");var a0=aM.find("device[ise_id='"+$(aZ).attr("ise_id")+"']").attr("interface");switch(a0){case undefined:return"";break;default:return a0}}},{name:"devicetype",index:"devicetype",width:110,fixed:true,xmlmap:function(aZ){var aY=$(aZ).attr("ise_id");var a0=aM.find("device[ise_id='"+$(aZ).attr("ise_id")+"']").attr("device_type");switch(a0){case undefined:return"";break;default:return a0}}},{name:"rooms",index:"rooms",width:120,fixed:true,xmlmap:function(aY){var aZ="";$(aY).find("channel").each(function(){var a0=$(this).attr("ise_id");var a1=L.find("channel[ise_id='"+a0+"']").parent().attr("name");if(a1!=undefined&&aZ.indexOf(a1)==-1){if(aZ!=""){aZ+=", "}aZ+=a1}});return aZ}},{name:"functions",index:"functions",width:120,fixed:true,xmlmap:function(aZ){var aY="";$(aZ).find("channel").each(function(){var a0=$(this).attr("ise_id");var a1=j.find("channel[ise_id='"+a0+"']").parent().attr("name");if(a1!=undefined&&aY.indexOf(a1)==-1){if(aY!=""){aY+=", "}aY+=a1}});return aY}},{name:"unreach",index:"unreach",width:80,hidden:true,xmlmap:function(aY){return $(aY).attr("unreach")}},{name:"sticky_unreach",index:"sticky_unreach",width:80,hidden:true,xmlmap:function(aY){return $(aY).attr("sticky_unreach")}},{name:"config_pending",index:"config_pending",width:80,hidden:true,xmlmap:function(aY){return $(aY).attr("config_pending")}},{name:"service",index:"service",width:120,fixed:true,xmlmap:function(aZ){var aY="";$(aZ).find("channel:first datapoint").each(function(){var a0=$(this).attr("ise_id");var a2=$(this).attr("value");var a1=$(this).attr("type");switch(a1){case"U_SOURCE_FAIL":case"U_USBD_OK":case"UNREACH":case"STICKY_UNREACH":case"LOWBAT":case"CONFIG_PENDING":case"DUTYCYCLE":case"BAT_LEVEL":case"INSTALL_MODE":if(a2=="true"){if(aY!=""){aY+=", "}aY+=a1}break;case"RSSI_DEVICE":case"RSSI_PEER":break;default:if(aY!=""){aY+=", "}aY+=a1+"="+a2}});return aY}}];var ah=["","Kanal Name","","Richtung","","",""];var aR=[{name:"ise_id",align:"right",index:"ise_id",width:48,fixed:true,xmlmap:function(aY){return $(aY).attr("ise_id")},classes:"ise_id"},{name:"name",index:"name",width:240,fixed:true,xmlmap:function(aY){return $(aY).attr("name")}},{name:"address",index:"address",width:79,fixed:true,xmlmap:function(a2){var aZ=$(a2).attr("ise_id");var aY=aC.find("channel[ise_id='"+aZ+"']").attr("address");if(aC.find("channel[ise_id='"+aZ+"']").attr("name")=="CCUWIR:0"){aY="BidCos-Wir:0"}if(aY==undefined){var a1=aC.find("channel[ise_id='"+aZ+"'] datapoint").attr("name");if(a1==undefined){aY=""}else{var a0=a1.split(".");aY=a0[1]}}return aY}},{name:"direction",index:"direction",width:78,fixed:true,xmlmap:function(a0){var aY=$(a0).attr("ise_id");var aZ=aM.find("channel[ise_id='"+aY+"']").attr("direction");if(aZ!=undefined){return aZ}else{return""}}},{name:"dummy1",index:"dummy1",width:110,fixed:true},{name:"rooms",index:"rooms",width:120,fixed:true,xmlmap:function(aZ){var aY="";L.find("channel[ise_id='"+$(aZ).attr("ise_id")+"']").each(function(){if(aY==""){aY=$(this).parent().attr("name")}else{aY+=", "+$(this).parent().attr("name")}});return aY}},{name:"functions",index:"functions",width:120,fixed:true,xmlmap:function(aY){return $(Y).find("channel[ise_id='"+$(aY).attr("ise_id")+"']").parent().attr("name")}}];var aL=["","Datenpunkt Name","Typ","Wert","Wertetyp","Zeitstempel"];var n=[{name:"ise_id",index:"ise_id",align:"right",width:46,fixed:true,xmlmap:function(aY){return $(aY).attr("ise_id")},classes:"ise_id"},{name:"name",index:"name",width:240,fixed:true,xmlmap:function(aY){return $(aY).attr("name")}},{name:"type",index:"type",width:60,hidden:true,xmlmap:function(aY){return $(aY).attr("type")}},{name:"value",index:"value",width:162,fixed:true,xmlmap:function(aY){var aZ=$(aY).attr("value");if($(aY).attr("valuetype")==6){aZ=parseFloat(aZ);aZ=aZ.toFixed(2)}return aZ}},{name:"valuetype",index:"valuetype",width:80,xmlmap:function(aY){return $(aY).attr("valuetype")}},{name:"timestamp",index:"timestamp",width:110,fixed:true,xmlmap:function(aY){return i($(aY).attr("timestamp"))}}];var Q=["ise_id","Name","Adresse","Gerätetyp","rssi_device","rssi_peer","RX","TX","AES Verfügbar","Übertragungsmodus","unreach","sticky_unreach","config_pending","Servicemeldungen"];var M=[{name:"ise_id",index:"ise_id",align:"right",width:40,xmlmap:function(a0){var aZ=$(a0).attr("device");var aY=aM.find("device[address='"+aZ+"']").attr("ise_id");return aY},classes:"ise_id"},{name:"name",index:"name",width:200,xmlmap:function(a0){var aZ=$(a0).attr("device");var aY=aM.find("device[address='"+aZ+"']").attr("name");return aY}},{name:"address",index:"address",width:80,xmlmap:function(aY){return $(aY).attr("device")}},{name:"device_type",index:"device_type",width:80,xmlmap:function(a0){var aZ=$(a0).attr("device");var aY=aM.find("device[address='"+aZ+"']").attr("device_type");return aY}},{name:"rssi_device",index:"rssi_device",width:60,xmlmap:function(a0){var aZ=$(a0).attr("device");var aY=aC.find("datapoint[name='BidCos-RF."+aZ+":0.RSSI_DEVICE']").attr("value");return aY}},{name:"rssi_peer",index:"rssi_peer",width:60,xmlmap:function(a0){var aY=$(a0).attr("device");var aZ=aC.find("datapoint[name='BidCos-RF."+aY+":0.RSSI_PEER']").attr("value");return aZ}},{name:"RX",index:"RX",width:60,xmlmap:function(aY){return $(aY).attr("rx")}},{name:"TX",index:"TX",width:60,xmlmap:function(aY){return $(aY).attr("tx")}},{name:"aes",index:"aes",width:60,xmlmap:function(a0){var aZ=$(a0).attr("device");var aY=aM.find("device[address='"+aZ+"'] channel:first").attr("aes_available");return aY}},{name:"mode",index:"mode",width:60,xmlmap:function(aZ){var aY=$(aZ).attr("device");var a0=aM.find("device[address='"+aY+"'] channel:first").attr("transmission_mode");if(a0=="AES"){a0='<span style="display:inline-block; align:bottom" class="ui-icon ui-icon-locked"></span> <span style="position:relative; top: -3px;">'+a0+"</span>"}return a0}},{name:"unreach",index:"unreach",width:80,hidden:true,xmlmap:function(aY){return $(aY).attr("unreach")}},{name:"sticky_unreach",index:"sticky_unreach",width:80,hidden:true,xmlmap:function(aY){return $(aY).attr("sticky_unreach")}},{name:"config_pending",index:"config_pending",width:80,hidden:true,xmlmap:function(aY){return $(aY).attr("config_pending")}},{name:"service",index:"service",width:120,hidden:true,xmlmap:function(aY){}}];var Z=["Datum Uhrzeit","Sender","Nachricht"];var ap=[{name:"datetime",index:"datetime",width:110,xmlmap:function(aY){return $(aY).attr("datetime")}},{name:"sender",index:"sender",width:250,xmlmap:function(aY){return $(aY).attr("names")}},{name:"msg",index:"msg",width:600,xmlmap:function(aY){return $(aY).attr("values")}}];l();aw.jqGrid({width:x,height:D,colNames:aD,colModel:aI,pager:"#gridPagerVariables",rowList:V,rowNum:d,viewrecords:true,gridview:true,caption:"Variablen",datatype:"xmlstring",loadonce:true,loadError:function(a0,aY,aZ){o(a0,aY,aZ)},ignoreCase:true,sortable:true,xmlReader:{root:"systemVariables",row:"systemVariable",id:"[ise_id]",repeatitems:false},ondblClickRow:function(a4){var a3=aw.getCell(a4,"value");var a2=aw.getCell(a4,"value_text");var a0=aw.getCell(a4,"value_list");var a1=aw.getCell(a4,"unit");var aZ=aw.getCell(a4,"type");var aY=aw.getCell(a4,"subtype");switch(aY){case"Logikwert":C.html("<select id='variableValue'><option value='false'>False</option><option value='true'>True</option></select>");$("#variableValue option[value='"+a3+"']").attr("selected",true);break;case"Werteliste":C.html("<select id='variableValue'>"+ai(a0)+"</select>");if(a3=="true"){a3="1"}else{if(a3=="false"){a3="0"}}$("#variableValue option[value='"+a3+"']").attr("selected",true);break;default:C.html("<input type='text' id='variableValue' value='"+a3+"'>"+a1)}S.html(aw.getCell(a4,"name"));K.val(a4);b.dialog("open")}}).filterToolbar({defaultSearch:"cn"}).jqGrid("navGrid","#gridPagerVariables",{edit:false,add:false,del:false,search:false,refresh:false}).jqGrid("navButtonAdd","#gridPagerVariables",{caption:"",buttonicon:"ui-icon-refresh",onClickButton:function(){aA()},position:"first",title:"Neu laden",cursor:"pointer"});ab.jqGrid({width:x,height:D,colNames:T,colModel:ac,pager:"#gridPagerPrograms",rowList:V,rowNum:d,viewrecords:true,gridview:true,caption:"Programme",datatype:"xmlstring",loadonce:true,loadError:function(a0,aY,aZ){o(a0,aY,aZ)},data:{},ignoreCase:true,sortable:true,xmlReader:{root:"programList",row:"program",id:"[id]",repeatitems:false},ondblClickRow:function(aY){ag.html(ab.getCell(aY,"name"));B.val(aY);aj.dialog("open")}}).filterToolbar({defaultSearch:"cn"}).jqGrid("navGrid","#gridPagerPrograms",{edit:false,add:false,del:false,search:false,refresh:false}).jqGrid("navButtonAdd","#gridPagerPrograms",{caption:"",buttonicon:"ui-icon-refresh",onClickButton:function(){av()},position:"first",title:"Neu laden",cursor:"pointer"});g.jqGrid({width:x,height:D,colNames:h,colModel:aV,pager:"#gridPagerStates",rowList:V,rowNum:d,viewrecords:true,gridview:true,caption:"Geräte",loadonce:true,loadError:function(a0,aY,aZ){o(a0,aY,aZ)},datatype:"xmlstring",data:{},ignoreCase:true,xmlReader:{root:"stateList",row:"device",id:"[ise_id]",repeatitems:false},sortable:true,subGrid:true,subGridRowExpanded:function(aZ,aY){v(aZ,aY)}}).filterToolbar({defaultSearch:"cn"}).jqGrid("navGrid","#gridPagerStates",{edit:false,add:false,del:false,search:false,refresh:false}).jqGrid("navButtonAdd","#gridPagerStates",{caption:"",buttonicon:"ui-icon-refresh",onClickButton:function(){E()},position:"first",title:"Neu laden",cursor:"pointer"});X.jqGrid({width:x,height:D,colNames:Q,colModel:M,pager:"#gridPagerRssi",rowList:V,rowNum:d,viewrecords:true,gridview:true,caption:"RSSI",loadonce:true,loadError:function(a0,aY,aZ){o(a0,aY,aZ)},datatype:"xmlstring",data:{},ignoreCase:true,xmlReader:{root:"rssiList",row:"rssi",id:"[device]",repeatitems:false},sortable:true}).filterToolbar({defaultSearch:"cn"}).jqGrid("navGrid","#gridPagerRssi",{edit:false,add:false,del:false,search:false,refresh:false}).jqGrid("navButtonAdd","#gridPagerRssi",{caption:"",buttonicon:"ui-icon-refresh",onClickButton:function(){k()},position:"first",title:"Neu laden",cursor:"pointer"});ao.jqGrid({width:x,height:D,colNames:Z,colModel:ap,pager:"#gridPagerProtocol",rowList:V,rowNum:d,viewrecords:true,gridview:true,caption:"Systemprotokoll",datatype:"xmlstring",loadonce:true,loadError:function(a0,aY,aZ){o(a0,aY,aZ)},data:{},sortable:true,ignoreCase:true,xmlReader:{root:"systemProtocol",row:"row",repeatitems:false}}).filterToolbar({defaultSearch:"cn"}).jqGrid("navGrid","#gridPagerProtocol",{edit:false,add:false,del:false,search:false,refresh:false}).jqGrid("navButtonAdd","#gridPagerProtocol",{caption:"",buttonicon:"ui-icon-refresh",onClickButton:function(){aF()},position:"first",title:"Neu laden",cursor:"pointer"}).jqGrid("navButtonAdd","#gridPagerProtocol",{caption:"",buttonicon:"ui-icon-trash",onClickButton:function(){N.dialog("open")},position:"last",title:"gesamtes Protokoll löschen",cursor:"pointer"});W.jqGrid({width:x,height:D,colNames:["",""],colModel:[{name:"key",index:"key",width:120,sortable:false},{name:"value",index:"value",width:600,sortable:false}],rowNum:10000,viewrecords:true,gridview:true,caption:"Info",ignoreCase:true,});aQ.jqGrid({width:343,height:200,colNames:["Variable","Wert"],colModel:[{name:"variable",index:"variable",width:80},{name:"value",index:"value",width:200}],rowNum:10000,viewrecords:true,gridview:true,caption:"Variablen",datatype:"json",loadonce:true,data:{},sortable:true,ignoreCase:true}).filterToolbar({defaultSearch:"cn"});function v(a0,aZ){var aY=a0+"_t";$("#"+a0).html("<table id='"+aY+"''></table>");$("#"+aY).jqGrid({colNames:ah,datatype:"xmlstring",datastr:p,colModel:aR,xmlReader:{root:"stateList>device[ise_id='"+aZ+"']",row:"channel",id:"[ise_id]",repeatitems:false},gridview:true,height:"100%",rowNum:1000,subGrid:true,subGridRowExpanded:function(a2,a1){aJ(a2,a1)}})}function aJ(a0,aZ){var aY=a0+"_t";$("#"+a0).html("<table id='"+aY+"''></table>");$("#"+aY).jqGrid({colNames:aL,datatype:"xmlstring",datastr:p,colModel:n,xmlReader:{root:"stateList>device>channel[ise_id='"+aZ+"']",row:"datapoint",id:"[ise_id]",repeatitems:false},gridview:true,height:"100%",rowNum:10000,ondblClickRow:function(a2){var a1=$("#"+aY).getCell(a2,"value").replace(/(\r\n|\n|\r)/gm,"");$("#datapointName").html($("#"+aY).getCell(a2,"name"));$("#datapointId").val(a2);$("#datapointGridId").val(aY);switch($("#"+aY).getCell(a2,"valuetype")){case"2":w.html("<select id='datapointValue'><option value='false'>False</option><option value='true'>True</option></select>");$("#datapointValue option[value='"+a1+"']").attr("selected",true);break;case"6":w.html("<div id='sliderDatapoint'></div><br><div id='radioDatapoint'><input type='radio' name='radioDatapoint' id='radioDatapointOff'><label for='radioDatapointOff'>Aus</label><input type='radio' name='radioDatapoint' id='radioDatapointOn'><label for='radioDatapointOn'>An</label></div><br><input type='text' id='datapointValue' value='"+a1+"'>");$("#radioDatapoint").buttonset();$("#sliderDatapoint").slider({min:0,max:1,step:0.01,value:a1,stop:function(a4,a3){a1=a3.value;$("input#datapointValue").val(a3.value)}});break;default:w.html("<input type='text' id='datapointValue' value='"+a1+"'>")}U.dialog("open")}})}function az(){at=true;aw.setGridParam({loadComplete:function(aY){if(aY.nodeType){aX=aY;aT=$(aY);aB=true}}});ab.setGridParam({loadComplete:function(aY){if(aY.nodeType){y=aY;aO=$(aY);O=true}}});g.setGridParam({loadComplete:function(aY){if(aY.nodeType){p=aY;aC=$(aY);ad=true}}});ao.setGridParam({loadComplete:function(){G=true}});X.setGridParam({loadComplete:function(){z=true}})}function aA(){$("#loaderVariables").show();aB=false;aw.setGridParam({url:r+a+"/sysvarlist.cgi?text=true",loadonce:false,datatype:"xml",mtype:"GET",loadComplete:function(aY){if(aY.nodeType){aB=true;aX=aY;aT=$(aY);$("#loaderVariables").hide();ay("Anzahl Variablen",aT.find("systemVariable").length)}if(!O){av()}}}).trigger("reloadGrid").setGridParam({loadonce:true})}function av(){$("#loaderPrograms").show();O=false;ab.setGridParam({url:r+a+"/programlist.cgi",loadonce:false,datatype:"xml",mtype:"GET",loadComplete:function(aY){if(aY.nodeType){O=true;y=aY;aO=$(aY);$("#loaderPrograms").hide();ay("Anzahl Programme",aO.find("program").length)}if(!ar){aK()}}}).trigger("reloadGrid").setGridParam({loadonce:true})}function E(){$("#loaderStates").show();ad=false;g.setGridParam({url:r+a+"/statelist.cgi",loadonce:false,datatype:"xml",mtype:"GET",loadComplete:function(aY){if(aY.nodeType){ad=true;p=aY;aC=$(aY);$("#loaderStates").hide();ay("Anzahl Datenpunkte",aC.find("datapoint").length);ay("Anzahl Kanäle",aC.find("channel").length);ay("Anzahl Geräte",aC.find("device").length)}if(!z){k()}}}).trigger("reloadGrid").setGridParam({loadonce:true})}function aF(){$("#loaderProtocol").show();G=false;ao.setGridParam({url:r+a+"/protocol.cgi",loadonce:false,datatype:"xml",mtype:"GET",loadComplete:function(){G=true;$("#loaderProtocol").hide();if(!at){az()}}}).trigger("reloadGrid").setGridParam({loadonce:true})}function k(){$("#loaderRssi").show();z=false;X.setGridParam({url:r+a+"/rssilist.cgi",loadonce:false,datatype:"xml",mtype:"GET",loadComplete:function(){$("#loaderRssi").hide();z=true;if(!G){aF()}}}).trigger("reloadGrid").setGridParam({loadonce:true})}function ak(){m.find("favorite[name='"+aW+"'] channel").each(function(){var aZ="";var aY=$(this).attr("ise_id");var a0=m.find("favorite[ise_id='"+aY+"']").attr("name");aZ+="<h3>"+a0+"</h3><div id='fav"+aY+"'></div>";$("div#accordionFavorites").append(aZ);m.find("favorite[ise_id='"+aY+"'] channel").each(function(){var a2="";var a1=$(this).attr("name");var a4=$(this).attr("ise_id");a2+="<div id='favItem"+a4+"' class='favItem ui-helper-reset ui-widget ui-widget-content ui-corner-all'><div class='favName'>"+a1+"</div></div>";$("div[id='fav"+aY+"']").append(a2);a2="";switch($(this).attr("type")){case"SYSVAR":$(this).find("systemVariable").each(function(){var a6=$(this).attr("value");var a5=$(this).attr("ise_id");a2+="<div class='favInput'>";switch($(this).attr("subtype")){case"2":a2+="<select id='favInputSelect"+a5+"'><option value='false'>False</option><option value='true'>True</option></select>";a2+="</div>";$("div[id='favItem"+a4+"']").append(a2);$("#favInputSelect"+a5+" option[value='"+a6+"']").attr("selected",true);$("#favInputSelect"+a5).change(function(){u(a5,$("#favInputSelect"+a5+" option:selected").val())});break;case"29":a2+="<select id='favInputSelect"+a5+"'>"+ai($(this).attr("value_list"))+"</select>";if(a6=="true"){a6="1"}else{if(a6=="false"){a6="0"}}a2+="</div>";$("div[id='favItem"+a4+"']").append(a2);$("#favInputSelect"+a5+" option[value='"+a6+"']").attr("selected",true);$("#favInputSelect"+a5).change(function(){u(a5,$("#favInputSelect"+a5+" option:selected").val())});break;default:a2+="<input type='text' id='favInputText"+a5+"' value='"+a6+"'>";a2+="</div>";$("div[id='favItem"+a4+"']").append(a2);$("#favInputText"+a5).eyup(function(a7){if(a7.keyCode==13){u(a5,$("#favInputText"+a5).val())}})}});break;case"PROGRAM":a2+="<br>"+$(this).attr("ise_id")+"<br>";$("div[id='favItem"+a4+"']").append(a2);break;case"CHANNEL":var a3=true;$(this).find("datapoint").each(function(){var a6=$(this).attr("name").split(".");var a7=a6[2];var ba=$(this).attr("ise_id");switch(a7){case"STATE":var a5="";var a8="";if($(this).attr("value")=="true"){a5=" checked='checked'"}else{a8=" checked='checked'"}a2+="<div class='favInput'>";a2+="<div class='favInputRadio' id='favRadio"+ba+"'>";a2+="<input id='favRadioOff"+ba+"' type='radio' name='favRadio"+ba+"'"+a8+">";a2+="<label for='favRadioOff"+ba+"'>Aus</label>";a2+="<input id='favRadioOn"+ba+"' type='radio' name='favRadio"+ba+"'"+a5+">";a2+="<label for='favRadioOn"+ba+"'>An</label>";a2+="</div>";a2+="</div>";if(!a3){$("div[id='favItem"+a4+"']").append("<div style='width: 100%; clear:both; height: 43px;'><br>")}a3=false;$("div[id='favItem"+a4+"']").append(a2);$("input#favRadioOn"+ba).change(function(bc,bb){if($(this).is(":checked")){u(ba,1)}});$("input#favRadioOff"+ba).change(function(bc,bb){if($(this).is(":checked")){u(ba,0)}});break;case"LEVEL":var a9=$(this).attr("value");a2+="<div class='favInput'>";a2+="<div class='favInputSlider' id='favSlider"+ba+"'>";a2+="</div>";a2+="</div>";if(!a3){$("div[id='favItem"+a4+"']").append("<div style='width: 100%; clear:both; height: 43px;'><br>")}a3=false;$("div[id='favItem"+a4+"']").append(a2);$("#favSlider"+ba).slider({min:0,max:1,step:0.01,value:a9,stop:function(bc,bb){u(bb.handle.parentElement.id.replace("favSlider",""),bb.value)}});break;case"PRESS_SHORT":break;case"PRESS_LONG":break;default:}});break;default:}})});$(".favInputRadio").buttonset();$("div#accordionFavorites").accordion({heightStyle:"content"})}aj.dialog({autoOpen:false,modal:true,buttons:{"Ausführen":function(){$(this).dialog("close");aE(B.val())},Abbrechen:function(){$(this).dialog("close")}}});aG.dialog({autoOpen:false,modal:true,buttons:{Ok:function(){$(this).dialog("close")}}});b.dialog({autoOpen:false,modal:true,buttons:{Ok:function(){var aY;if(C.find("select").attr("id")){aY=$("#variableValue option:selected").val()}else{aY=$("#variableValue").val()}u(K.val(),aY,function(){af(K.val())});$(this).dialog("close")},Abbrechen:function(){$(this).dialog("close")}}});U.dialog({autoOpen:false,modal:true,buttons:{Ok:function(){u($("#datapointId").val(),$("#datapointInput #datapointValue").val(),function(){ae($("#datapointId").val(),$("#datapointGridId").val())});$(this).dialog("close")},Abbrechen:function(){$(this).dialog("close")}}});N.dialog({autoOpen:false,modal:true,buttons:{"Löschen":function(){$(this).dialog("close");q()},Abbrechen:function(){$(this).dialog("close")}}});ax.dialog({autoOpen:false,modal:true,buttons:{Ok:function(){$(this).dialog("close");au($("#selectUiTheme").val())},Abbrechen:function(){$(this).dialog("close")}}});$("#dialogDebugScript").dialog({autoOpen:false,modal:true,buttons:{Schliessen:function(){$(this).dialog("close");$("#debugScript").html("")}}});$("button#hmRunScript").click(function(){aQ.jqGrid("clearGridData");J(editAreaLoader.getValue("hmScript"),function(aY){$.each(aY,function(aZ,a0){switch(aZ){case"STDOUT":$("textarea#hmScriptStdout").val(a0);break;case"httpUserAgent":case"sessionId":break;default:aQ.jqGrid("addRowData",aZ,{variable:aZ,value:a0})}});$("#loaderScript").hide()})});$("button#hmDebugScript").click(function(){aQ.jqGrid("clearGridData");var aZ=editAreaLoader.getValue("hmScript");var aY=aZ+"\nvar hqDebugDummy=1;";var a0;J(aY,function(a2){var a4=false;var a3=false;var a1=0;$.each(a2,function(a5,a6){switch(a5){case"STDOUT":$("textarea#hmScriptStdout").val(a6);break;case"httpUserAgent":case"sessionId":break;default:if(!a5.match("hqDebugDummy")){aQ.jqGrid("addRowData",a5,{variable:a5,value:a6})}else{a3=true;if(a6=="null"){a4=true}}}});if(!a4&&a3){$("#debugScript").html("Scriptausführung erfolgreich.");$("#dialogDebugScript").dialog("open")}else{$.ajax({url:r+a+"/scripterrors.cgi",type:"GET",success:function(a6){var a5=$(a6).find("error:last");$("#debugScript").html(a5.attr("timestamp")+" "+a5.attr("msg")+" in Zeile "+a5.attr("row"));$("#dialogDebugScript").dialog("open")}})}$("#loaderScript").hide()})});function q(){$.ajax({url:r+a+"/protocol.cgi",type:"GET",data:{clear:1},success:function(){aF()},error:function(a0,aY,aZ){o(a0,aY,aZ)}})}function aE(aY){$.ajax({url:r+a+"/runprogram.cgi",type:"GET",data:{program_id:aY},success:function(aZ){av()},error:function(a1,aZ,a0){o(a1,aZ,a0)}})}function u(aZ,a0,aY){$.ajax({url:r+a+"/statechange.cgi",type:"GET",data:{ise_id:aZ,new_value:a0},success:function(a1){if(aY!==undefined){aY(a1)}},error:function(a3,a1,a2){o(a3,a1,a2)}})}function ae(aY,aZ){setTimeout(function(){s(aY,aZ)},1000);setTimeout(function(){s(aY,aZ)},1500);setTimeout(function(){s(aY,aZ)},2000);setTimeout(function(){s(aY,aZ)},3000);setTimeout(function(){s(aY,aZ)},5000);setTimeout(function(){s(aY,aZ)},30000)}function s(aY,aZ){$.ajax({url:r+a+"/state.cgi",type:"GET",async:false,data:{datapoint_id:aY},success:function(a0){$("tr#"+aY+" td[aria-describedby$='value']").each(function(){$(this).html($(a0).text())})},error:function(a2,a0,a1){o(a2,a0,a1)}})}function af(aY){$.ajax({url:r+a+"/sysvar.cgi",type:"GET",async:false,data:{ise_id:aY},success:function(a0){var aZ=$(a0).find("systemVariable");aw.find("tr#"+aY+" td[aria-describedby$='value']").html(aZ.attr("value"));aw.find("tr#"+aY+" td[aria-describedby$='value_text']").html(aZ.attr("value_text"));aw.find("tr#"+aY+" td[aria-describedby$='variable']").html(aZ.attr("variable"));aw.find("tr#"+aY+" td[aria-describedby$='timestamp']").html(i(aZ.attr("timestamp")))},error:function(a1,aZ,a0){o(a1,aZ,a0)}})}function aU(){var aY=storage.get("hqWebUiDevices");if(aY!==null){aH=true;I=$.parseXML(aY);aM=$(I);E();return false}$.ajax({url:r+a+"/devicelist.cgi",type:"GET",dataType:"xml",success:function(aZ){aH=true;I=aZ;aM=$(aZ);storage.set("hqWebUiDevices",(new XMLSerializer()).serializeToString(aZ));E()},error:function(a1,aZ,a0){o(a1,aZ,a0)}})}function aK(){$("#loaderStates").show();var aY=storage.get("hqWebUiFunctions");if(aY!==null){ar=true;Y=$.parseXML(aY);j=$(Y);F();return false}$.ajax({url:r+a+"/functionlist.cgi",type:"GET",dataType:"xml",success:function(aZ){ar=true;Y=aZ;j=$(aZ);storage.set("hqWebUiFunctions",(new XMLSerializer()).serializeToString(aZ));F()},error:function(a1,aZ,a0){o(a1,aZ,a0)}})}function F(){var aY=storage.get("hqWebUiRooms");if(aY!==null){aN=true;aa=$.parseXML(aY);L=$(aa);aU();return false}$.ajax({url:r+a+"/roomlist.cgi",type:"GET",dataType:"xml",success:function(aZ){aN=true;aa=aZ;L=$(aZ);storage.set("hqWebUiRooms",(new XMLSerializer()).serializeToString(aZ));aU()},error:function(a1,aZ,a0){o(a1,aZ,a0)}})}function am(){$("#loaderFavorites").show();$.ajax({url:r+a+"/favoritelist.cgi?show_datapoint=1",type:"GET",dataType:"xml",success:function(aY){aA();aP=true;aS=aY;m=$(aY);ak();$("#loaderFavorites").hide();aA()},error:function(a0,aY,aZ){$("#loaderFavorites").hide();o(a0,aY,aZ)}})}function l(){$.ajax({url:r+a+"/version.cgi",type:"GET",dataType:"xml",success:function(aY){A=$(aY).text();W.jqGrid("addRowData","HQ WebUI Version",{key:"HQ WebUI Version",value:H});W.jqGrid("addRowData","XML-API Version",{key:"XML-API Version",value:A})},error:function(a0,aY,aZ){o(a0,aY,aZ)}})}function J(aZ,aY){$("#loaderScript").show();$.ajax({url:r+a+"/exec.cgi",type:"POST",data:aZ,dataType:"json",success:function(a0){$("#loaderScript").hide();aY(a0)},error:function(a2,a0,a1){o(a2,a0,a1)}})}function ay(aY,aZ){W.jqGrid("addRowData",aY,{key:aY,value:aZ})}function ai(a1){var aZ="";var aY=a1.split(";");for(var a0=0;a0<aY.length;a0++){aZ=aZ+"<option value='"+a0+"'>"+aY[a0]+"</option>"}return aZ}function o(a0,aY,aZ){$("#ajaxOptions").html(aY);$("#thrownError").html(aZ);aG.dialog("open")}function c(aY){switch(aY){case"6":return"Alarm";break;case"29":return"Werteliste";break;case"2":return"Logikwert";break;case"11":return"Zeichenkette";break;case"0":return"Zahl";break;default:return""}}function i(a2){var aZ=new Date();aZ.setTime(a2+"000");var a3=(aZ.getMonth()+1).toString(10);a3=(a3.length==1?"0"+a3:a3);var a0=aZ.getDate().toString(10);a0=(a0.length==1?"0"+a0:a0);var aY=aZ.getHours().toString(10);aY=(aY.length==1?"0"+aY:aY);var a4=aZ.getMinutes().toString(10);a4=(a4.length==1?"0"+a4:a4);var a1=aZ.getSeconds().toString(10);a1=(a1.length==1?"0"+a1:a1);return aZ.getFullYear()+"-"+a3+"-"+a0+" "+aY+":"+a4+":"+a1}function au(aY){storage.set("hqWebUiTheme",aY);$("#theme").attr("href",an+aY+aq)}function al(){var aY=storage.get("hqWebUiTheme");if(aY===null){aY=t}$("#theme").attr("href",an+aY+aq)}editAreaLoader.init({id:"hmScript",start_highlight:true,word_wrap:true,plugins:"autocompletion",autocompletion:true,font_size:"10",allow_resize:"no",allow_toggle:false,display:"onload",language:"de",syntax:"hmscript",replace_tab_by_spaces:4,min_height:570,min_width:640,toolbar:"search, fullscreen, |, undo, redo, |, select_font,|, reset_highlight ,|, autocompletion"})});